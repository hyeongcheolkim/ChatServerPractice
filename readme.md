# IOCP 기반 채팅 서버 및 클라이언트 (Windows)

이 프로젝트는 C++로 작성된 간단한 채팅 애플리케이션으로, 서버와 클라이언트 모델을 사용하며, 비동기 처리를 위해 IOCP(입출력 완료 포트)를 활용합니다. 채팅은 **에코**와 **브로드캐스트** 메시지 타입을 지원합니다. 메시지 직렬화에는 Protocol Buffers를 사용하고, 네트워킹에는 Winsock을 사용합니다.
## 파일 구조
- [Client코드 바로가기](https://github.com/hyeongcheolkim/ChatServerPractice/blob/master/ClientServer/ClientServer.cpp)
- [Server코드 바로가기](https://github.com/hyeongcheolkim/ChatServerPractice/blob/master/ChatServerPractice/ChatServerPractice.cpp)
## 시연영상
- 에코기능과 브로드캐스트 기능시연
![Image](https://github.com/user-attachments/assets/1c71f074-e1d4-47b5-9e28-6087696fbadd)

## 기능
- **에코**: 서버는 클라이언트의 메시지를 받아 "(echo)" 접두어를 붙여서 다시 전송합니다.
- **브로드캐스트**: 서버는 클라이언트의 메시지를 모든 연결된 클라이언트에게 "(broadcast)" 접두어를 붙여 전송합니다.
- **비동기 처리**: IOCP를 사용하여 여러 클라이언트 연결을 효율적으로 처리합니다.
- **스레드 관리**: IOCP 이벤트 처리를 여러 스레드에서 동시에 수행합니다.
- **세션 관리**: 서버는 연결된 모든 클라이언트를 세션 풀에 관리합니다.

## 요구 사항
- C++11 이상
- [Protocol Buffers](https://developers.google.com/protocol-buffers) 라이브러리 (3.11.4버전) (메시지 직렬화를 위한 라이브러리)
- Windows 환경 (Winsock과 IOCP를 사용하기 위해 필요)


## 코드 설명

### 클라이언트 (클라이언트 측)

1. **소켓 설정**: 
    - TCP 소켓을 생성하고, 서버에 비동기 연결을 시도합니다.
    - IOCP 핸들을 생성하여 비동기 이벤트를 처리합니다.
2. **메시지 전송 및 수신**: 
    - 사용자가 입력한 메시지를 Protocol Buffers 형식으로 직렬화하여 서버로 전송합니다.
    - 서버에서 응답을 받으면, 에코 또는 브로드캐스트 메시지를 출력합니다.
3. **에코 및 브로드캐스트 처리**: 
    - `echo` 타입의 메시지는 서버가 동일한 메시지를 다시 클라이언트에게 보냅니다.
    - `broadcast` 타입의 메시지는 서버가 모든 클라이언트에게 전달합니다.
4. **IOCP 비동기 처리**: 
    - 서버와의 통신은 비동기적으로 처리되며, 클라이언트는 비동기적으로 데이터를 송수신합니다.
5. **로그 동기화**: 
    - 메시지 송수신 로그의 순서를 보장하기 위해 뮤텍스와 조건 변수를 사용하여 로그 출력을 동기화합니다.

### 서버 (서버 측)

1. **소켓 설정**: 
    - 서버 소켓을 생성하고, 클라이언트의 연결을 기다립니다.
    - 새로운 클라이언트가 연결되면 세션을 생성하고 IOCP 핸들에 등록합니다.
2. **IOCP 처리**: 
    - 서버는 여러 스레드에서 IOCP 이벤트를 비동기적으로 처리합니다. 클라이언트로부터 메시지를 수신한 후, 메시지 타입에 따라 에코 또는 브로드캐스트를 처리합니다.
3. **클라이언트 관리**: 
    - 서버는 모든 클라이언트를 세션 풀에 관리하며, 각 클라이언트의 메시지를 처리합니다.
4. **메시지 처리**: 
    - `ECHO` 타입 메시지는 클라이언트에게 에코 메시지를 전송하고, `BROADCAST` 타입 메시지는 모든 클라이언트에게 전송합니다.
5. **세션 해제**: 
    - 클라이언트 연결이 끊어지면 세션 풀에서 해당 세션을 제거하고, 연결 종료 메시지를 출력합니다.

## 빌드 및 실행 방법

1. Visual Studio에서 프로젝트를 열고 빌드합니다.
2. ChatServerPractice모듈의 main 실행합니다. 이는 server역할을 수행합니다.
3. ClientServer모듈의 main을 실행합니다. 이는 client역할을 수행합니다.
4. 서버 실행 후 클라이언트는 서버에 연결하여 채팅을 시작할 수 있습니다.
5. 클라이언트는 메시지 타입을 선택하고, 메시지를 입력하여 서버와 상호작용할 수 있습니다.
6. client역할의 ClientServer모듈의 main은 여러개 실행시킬 수 있습니다.

## 주요 함수 설명

### `IocpProcess(HANDLE iocpHandle)`
- IOCP에서 완료된 이벤트를 처리하는 함수로, 클라이언트로부터 받은 메시지의 타입에 따라 적절히 응답합니다.

### `main()`
- 서버와 클라이언트 각각의 실행 로직을 처리하는 함수입니다. 서버는 클라이언트를 기다리고, 클라이언트는 서버에 메시지를 보냅니다.